<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.1.0/css/all.css"
      integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
      crossorigin="anonymous"
    />
    <script src="https://unpkg.com/xlsx@latest/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/file-saverjs@latest/FileSaver.min.js"></script>
    <script src="https://unpkg.com/tableexport@latest/dist/js/tableexport.min.js"></script>

    <link
      href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Slab"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Crear Activo</title>
  </head>

  <body background="img/8.jpg">
    <div id="slideout-menu">
      <ul>
        <li>
          <a href="index.html">Inicio</a>
        </li>
        <li>
          <a href="activos.html">Crear Acivo</a>
        </li>
        <li>
          <a href="prestar.html">Prestar</a>
        </li>
        <li>
          <a href="Listado.html">Listado De Activos</a>
        </li>
        <li>
          <a href="historialprestamo.html">Historial De Prestamos</a>
        </li>
        <li>
          <a href="descargar.html">Descargar Activos</a>
        </li>
        <li>
          <a href="descipciones.html">Descripcion De Movimiento MPU6050</a>
        </li>
      </ul>
    </div>

    <nav>
      <div id="logo-img">
        <a href="#">
          <img src="img/logo.png" alt="GTCoding Logo" />
        </a>
      </div>
      <div id="menu-icon">
        <i class="fas fa-bars"></i>
      </div>
      <ul>
        <li>
          <a href="index.html">Inicio</a>
        </li>
        <li>
          <a href="activos.html">Crear Activo</a>
        </li>
        <li>
          <a href="prestar.html">Prestar</a>
        </li>
        <li>
          <a href="Listado.html">Listado De Activos</a>
        </li>
        <li>
          <a href="historialprestamo.html">Historial De Prestamos</a>
        </li>
        <li>
          <a href="descargar.html">Decargar Activos</a>
        </li>
        <li>
          <a href="descipciones.html" class="active"
            >Descripcion De Movimiento MPU6050</a
          >
        </li>
      </ul>
    </nav>

    <div id="searchbox">
      <input type="text" placeholder="Search Here" />
    </div>

    <main>
      <h2 class="page-heading">Historial De Todos Los Prestamos</h2>
      <button
        id="btnExportar"
        style="
          text-decoration: none;
          padding: 10px;
          font-weight: 600;
          font-size: 20px;
          color: #ffffff;
          background-color: #1883ba;
          border-radius: 6px;
          border: 2px solid #0016b0;
          margin-left: 50%;
        "
      >
        Exportar
      </button>

      <center>
        <div class="container">
          <table border id="tabla">
            <thead>
              <tr>
                <th style="color: white; padding: 20px">Identificador</th>
                <th style="color: white; padding: 20px">Fecha</th>
                <th style="color: white; padding: 20px">Codigo Del Activo</th>
                <th style="color: white; padding: 20px">Usuario</th>
              </tr>
            </thead>
            <tbody id="tablas" style="color: white; padding: 20px"></tbody>
          </table>
        </div>
      </center>
    </main>

    <script src="main.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-database.js"></script>
    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyBHN1iv58dJJGSO7w4U2PmHIzpag9vDP4w",
        authDomain: "iot-prueba-548fa.firebaseapp.com",
        databaseURL: "https://iot-prueba-548fa.firebaseio.com",
        projectId: "iot-prueba-548fa",
        storageBucket: "iot-prueba-548fa.appspot.com",
        messagingSenderId: "1008402735008",
        appId: "1:1008402735008:web:f477539521ee12bd698ec5",
        measurementId: "G-R9EM8QPEEJ",
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      var table = document.getElementById("tablas");

      //limpia la tabla
      table.innerHTML = "";

      //con esta funci√≥n recorre todos los datos almacenados en FB ordenados por mi child(tipo)

      readList();
      function readList() {
        var task = firebase.database().ref("/PrestamosEstudiantiles");
        task.on("child_added", function (data) {
          var taskValue = data.val();
          var row = table.insertRow(0);
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          var cell3 = row.insertCell(2);
          var cell4 = row.insertCell(3);

          cell1.innerHTML = taskValue.id + "";
          cell2.innerHTML = taskValue.fecha;
          cell3.innerHTML = taskValue.tagPrestamo;
          cell4.innerHTML = taskValue.usuario;
        });
      }
    </script>
    <script>
      const $btnExportar = document.querySelector("#btnExportar"),
        $tabla = document.querySelector("#tabla");

      $btnExportar.addEventListener("click", function () {
        let tableExport = new TableExport($tabla, {
          exportButtons: false,
          filename: "Historial De Activos",
          sheetname: "Hoja1",
        });
        borrarNodo();
        let datos = tableExport.getExportData();
        let preferenciasDocumento = datos.tabla.xlsx;
        tableExport.export2file(
          preferenciasDocumento.data,
          preferenciasDocumento.mimeType,
          preferenciasDocumento.filename,
          preferenciasDocumento.fileExtension,
          preferenciasDocumento.merges,
          preferenciasDocumento.RTL,
          preferenciasDocumento.sheetname
        );
      });
      function borrarNodo() {
        console.log("Nodo Borrado");
        var task = firebase.database().ref("/PrestamosEstudiantiles");
        task.remove();
      }
    </script>
  </body>
</html>
