<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
    crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Slab" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <title>Prestamos</title>
</head>

<body background="img/8.jpg">
  <div id="slideout-menu">
      <ul>
          <li>
              <a href="index.html">Inicio</a>
          </li>
          <li>
              <a  href="activos.html">Crear Activo</a>
          </li>
          <li>
              <a href="prestar.html">Prestar</a>
          </li>
          <li>
              <a href="Listado.html">Listado De Activos</a>
          </li>
          <li>
            <a href="historialprestamo.html">Historial De Prestamos</a>
        </li>
        <li>
            <a href="descargar.html">Descargar Activos</a>
        </li>
      </ul>
  </div>

  <nav>
      <div id="logo-img">
          <a href="#">
              <img src="img/logo.png" alt="GTCoding Logo">
          </a>
      </div>
      <div id="menu-icon">
          <i class="fas fa-bars"></i>
      </div>
      <ul>
          <li>
              <a href="index.html">Inicio</a>
          </li>
          <li>
              <a  href="activos.html">Crear Activo</a>
          </li>
          <li>
              <a class="active"href="prestar.html">Prestar</a>
          </li>
          <li>
              <a href="Listado.html">Lista De Activos</a>
          </li>
          <li>
            <a href="historialprestamo.html">Historial De Prestamos</a>
        </li>
        <li>
            <a href="descargar.html">Descargar Activos</a>
        </li>
          
      </ul>
  </nav>

  <div id="searchbox">
      <input type="text" placeholder="Search Here">
  </div>

  <main>

    <h2 class="page-heading">Existencia Del Activo</h2>
    
    <div>
        <div class="container">
            <center><div id="tag" style="color:#ffffff"></div></center>
            <br>
            <center><p id="aux" style="color:#ffffff"></p></center>
            <center><p id="verificacion" style="color:#ffffff"></p></center>

            <center> <h2 style="color:#ffffff">Detalle del Prestamo</h2></center>
            <div class="row">
                <center><form id="form">
                    
                   
                </form></center>
    
            </div>
            <br>
            
            
        </div>
    </div>
    

  </main>

  <script src="main.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-database.js"></script>
<script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
      apiKey: "AIzaSyBHN1iv58dJJGSO7w4U2PmHIzpag9vDP4w",
      authDomain: "iot-prueba-548fa.firebaseapp.com",
      databaseURL: "https://iot-prueba-548fa.firebaseio.com",
      projectId: "iot-prueba-548fa",
      storageBucket: "iot-prueba-548fa.appspot.com",
      messagingSenderId: "1008402735008",
      appId: "1:1008402735008:web:f477539521ee12bd698ec5",
      measurementId: "G-R9EM8QPEEJ"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

  
  
var d= new Date();
  var t=d.getTime();
  var counter=t;
  
  document.getElementById("form").addEventListener("submit",(e)=>{
        var tag=document.getElementById("tagPrestamo").value;
        var name=document.getElementById("prestante").value;
        var fecha=document.getElementById("tagfecha").value;
        e.preventDefault();
        createTask(tag,name,fecha);
        form.reset();
  })
function createTask(taskName,descriptio,fec){
counter+=1;
console.log(counter);
var task={
    tagPrestamo:taskName,
    id:counter,
    usuario:descriptio,
    fecha:fec
}
let db=firebase.database().ref("PrestamosEstudiantiles/"+counter);
db.set(task);

}

//readTask();
readTag();
function readTag(){
    var tagi=firebase.database().ref("prestamo/");
    tagi.on("child_added",function(data){
        var tagValue=data.val();
        var tags=`${tagValue.tag}`;
        document.getElementById("tag").innerHTML=`
        <p>Tag Leido</p>
        <p id="valor">${tags}</p>
        `;
        buscarTag(tags);
       
    });
}
function cuadrado() {
    var d= new Date();
    var cas=d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear();
   return cas;
}
let ariel= new Array();
function buscarTag(tags){
    document.getElementById("aux").innerText=tags;
    var task=firebase.database().ref("Activos/");
    let arrayaux=[];
   
   task.orderByChild('tag').equalTo(tags).on('value',snapshot=>{
    
    if(snapshot.val()!= null){
        var username = snapshot.val().key;
        var fecha=cuadrado();
        console.log(username);
        document.getElementById("verificacion").innerText="El tag Existe en la BD";
            document.getElementById("form").innerHTML=`
            <div class="form-group">
                    <label for="exampleInputEmail1" style="color:#ffffff">Tag Prestamo</label>
                    <br>
                    <br>
                    <input type="text" class="form-control" id="tagPrestamo" value=${tags}>
                    
                  </div>
                  <div class="form-group">
                    <br>
                    <label for="exampleInputEmail1" style="color:#ffffff">Fecha Del Prestamo</label>
                    <br>
                    <br>
                    <input type="text" class="form-control" id="tagfecha"  value=${fecha}>
                    
                  </div>
                  <div class="form-group">
                  <br>
                      <label for="exampleInputEmail1" style="color:#ffffff">Nombre del Usuario</label>
                      <br>
                    <br>
                      <input type="text" class="form-control" id="prestante" aria-describedby="emailHelp">
                    
                    </div>
                    <br>
                <button type="submit" class="btn btn-primary" id="button1" style="text-decoration: none;
                    padding: 10px;
                    font-weight: 600;
                    font-size: 20px;
                    color: #ffffff;
                    background-color: #1883ba;
                    border-radius: 6px;
                    border: 2px solid #0016b0;">Prestar Activo</button>
            `;
            
    }else{
        document.getElementById("verificacion").innerText="No existe el tag en la BD";
        document.getElementById("form").innerHTML=``;
    }
   });
  

}

  </script>
</body>

</html>